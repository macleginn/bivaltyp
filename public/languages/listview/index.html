<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>BivalTyp</title>
        <!-- Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">

        <!-- Icons -->
        <link rel="apple-touch-icon" sizes="180x180" href="https://www.bivaltyp.info/icons/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://www.bivaltyp.info/icons/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://www.bivaltyp.info/icons/favicon-16x16.png">
        <link rel="manifest" href="https://www.bivaltyp.info/icons/site.webmanifest">

        <link rel="stylesheet" href="https://www.bivaltyp.info/css/style.css">

        <!-- dataframe-js -->
        <script src="https://www.bivaltyp.info/js/dataframejs/dataframe.min.js"></script>

        <!-- Handsontable -->
        <script src="https://www.bivaltyp.info/js/handsontable/handsontable.full.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://www.bivaltyp.info/js/handsontable/handsontable.full.min.css">

        <!-- Load data -->
        <script src="https://www.bivaltyp.info/js/data/languages.js"></script>
        <script src="https://www.bivaltyp.info/js/data/predicates.js"></script>
        <script src="https://www.bivaltyp.info/js/data/patterns.js"></script>
        <script src="https://www.bivaltyp.info/js/data/full.js"></script>
        <script src="https://www.bivaltyp.info/js/data/structural.js"></script>

        <!-- Misc JavaScript -->
        <script src="https://www.bivaltyp.info/js/misc.js"></script>

    </head>
<body>
<div id="title-div">
    <div>
        <h1><a href="https://www.bivaltyp.info" style="text-decoration: none; color: black;">BivalTyp</a></h1>
    </div>
    <div>
        <a href="https://iling.spb.ru/index.html.ru"><img src="https://www.bivaltyp.info/images/ili.png" alt="Институт лингвистических исследований РАН"></a>
    </div>
</div>
<div id="menu">
    <div class="menu-element">
        <a href="https://www.bivaltyp.info"><div class="menu-button">Home</div></a>
    </div>
    <div class="menu-element">
        <div class="menu-button" onclick="toggle('project-submenu');">Project ↓</div>
        <div class="submenu" id="project-submenu">
            <a href="https://www.bivaltyp.info/project/description/"><div class="menu-button">Project description</div></a>
            <a href="https://www.bivaltyp.info/project/questionnaire/"><div class="menu-button">Questionnaire</div></a>
            <a href="https://www.bivaltyp.info/project/instruction/"><div class="menu-button">Instructions for&nbsp;contributors</div></a>
            <a href="https://www.bivaltyp.info/project/team/"><div class="menu-button">Team</div></a>
            <a href="https://www.bivaltyp.info/project/publications/"><div class="menu-button">Publications</div></a>
        </div>
    </div>
    <div class="menu-element">
        <a href="https://www.bivaltyp.info/howtoreadthedata/"><div class="menu-button">How to read the data</div></a>
    </div>
    <div class="menu-element">
        <div class="menu-button" onclick="toggle('languages-submenu');">Languages ↓</div>
        <div class="submenu" id="languages-submenu">
            <a href="https://www.bivaltyp.info/languages/listview/"><div class="menu-button">List view</div></a>
            <a href="https://www.bivaltyp.info/languages/mapview/"><div class="menu-button">Map view</div></a>
        </div>
    </div>
    <div class="menu-element">
        <a href="https://www.bivaltyp.info/predicates/"><div class="menu-button">Predicates</div></a>
    </div>
    <div class="menu-element">
        <div class="menu-button" onclick="toggle('data-submenu');">Data overview ↓</div>
        <div class="submenu" id="data-submenu">
            <a href="https://www.bivaltyp.info/data/patterns/"><div class="menu-button">Patterns overview</div></a>
            <a href="https://www.bivaltyp.info/data/all/"><div class="menu-button">Data in one spreadsheet</div></a>
        </div>
    </div>
    <div class="menu-element">
        <a href="https://www.bivaltyp.info/data/maps/"><div class="menu-button">Maps</div></a>
    </div>
    <div class="menu-element">
        <a href="https://www.bivaltyp.info/download/"><div class="menu-button">Download</div></a>
    </div>
</div>

<div id="main"><h2>List of languages</h2>
<p>Click on the ‘link’ near the name of a language to open the description. Summary data for languages being prepared for publication can be found in the ‘<a href="../../data/patterns/">Patterns overview</a>’ section</p>
<div id="table"></div>
<script>
    // dataframe-js singleton object.
    let DataFrame = dfjs.DataFrame;

    let columnNames = languageData[0],
        languageDf = new DataFrame(
            languageData.slice(1),
            columnNames
        ),
        idxDict = {};
    columnNames.forEach((colname, idx) => { idxDict[colname] = idx; });

    let external2internal = {};
    for (const row of languageData.slice(1))
        external2internal[row[idxDict['language_external']]] = row[idxDict['language']];

    const selectedColumns = [
        "glottocode",
        "language_external",
        "macroarea",
        "family (WALS)",
        "genus (WALS)",
        "overallN",
        "transitives",
        "intransitives",
        "transitivity ratio",
        "intransitivity ratio",
        "X",
        "Y",
        "XY",
        "number of classes",
        "entropy (nat)",
        "normalised entropy",
        "entropy of intransitives (nat)",
        "maximum entropy for intransitives",
        "entropy ratio"
    ];

    let activeLanguages = new Set();
    for (const row of fullData.slice(1)) {
        activeLanguages.add(row[0]);
    }

    function getLink(row) {
        if (activeLanguages.has(row.get('language_external')))
            return `<a class="table-link" href="../descriptions/${external2internal[row.get('language_external')]}.html">link</a>`;
        else
            return '';
    }

    // Prettify the df and subset columns
    let languageDfMin = languageDf
        .sortBy('language_external')
        .chain(
            row => row.set('transitivity ratio', row.get('transitivity ratio').toFixed(2)),
            row => row.set('intransitivity ratio', row.get('intransitivity ratio').toFixed(2)),
            row => row.set('entropy (nat)', row.get('entropy (nat)').toFixed(2)),
            row => row.set('normalised entropy', row.get('normalised entropy').toFixed(2)),
            row => row.set('entropy of intransitives (nat)', row.get('entropy of intransitives (nat)').toFixed(2)),
            row => row.set('maximum entropy for intransitives', row.get('maximum entropy for intransitives').toFixed(2)),
            row => row.set('entropy ratio', row.get('entropy ratio').toFixed(2))
        )
        .select(...selectedColumns);

    // Add a link column
    selectedColumns.splice(1, 0, 'language_link')
    languageDfMin = languageDfMin.restructure(selectedColumns);
    languageDfMin = languageDfMin.map(row => row.set('language_link', getLink(row)))

    let columns = [],
        columnNamesDisplay = [];
    for (const colname of selectedColumns) {
        if (colname === 'language_external') {
            columnNamesDisplay.push('language');
            columns.push({renderer: 'text'});
        } else if (colname === 'language_link') {
            columnNamesDisplay.push(colname);
            columns.push({renderer: 'html'});
        } else {
            columnNamesDisplay.push(colname);
            columns.push({renderer: 'text'});
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        new Handsontable(byId('table'), {
            licenseKey: 'non-commercial-and-evaluation',
            data: languageDfMin.toArray(),
            colHeaders: columnNamesDisplay,
            editor: false,
            rowHeaders: false,
            filters: true,
            dropdownMenu: ['filter_by_condition', 'filter_by_value', 'filter_action_bar'],
            columns: columns,
            columnSorting: true
        });
    })
</script>
</div>


</body>
</html>

