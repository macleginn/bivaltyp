<h2>List of languages</h2>
<p>Click on the ‘link’ near the name of a language to open the description. Summary data for languages being prepared for publication can be found in the ‘<a href="../../data/patterns/">Patterns overview</a>’ section</p>
<div id="table"></div>
<script>
    // dataframe-js singleton object.
    let DataFrame = dfjs.DataFrame;

    let columnNames = languageData[0],
        languageDf = new DataFrame(
            languageData.slice(1),
            columnNames
        ),
        idxDict = {};
    columnNames.forEach((colname, idx) => { idxDict[colname] = idx; });

    let external2internal = {};
    for (const row of languageData.slice(1))
        external2internal[idxDict['language_external']] = row[idxDict['language']];

    // const selectedColumns = [
    //     'language_external',
    //     'macroarea',
    //     'family (WALS)',
    //     'genus (WALS)',
    //     'number of classes',
    //     'transitives',
    //     'X-locus',
    //     'Y-locus',
    //     'XY-locus',
    //     'transitivity ratio',
    //     'entropy (nat)'
    // ];

    const selectedColumns = [
        "language_external",
        "macroarea",
        "family (WALS)",
        "genus (WALS)",
        "latitude",
        "longitude",
        "overallN",
        "transitives",
        "intransitives",
        "transitivity ratio",
        "intransitivity ratio",
        "X",
        "Y",
        "XY",
        "number of classes",
        "entropy (nat)",
        "normalised entropy",
        "entropy of intransitives (nat)",
        "maximum entropy for intransitives",
        "entropy ratio"
    ];

    let activeLanguages = new Set();
    for (const row of fullData.slice(1)) {
        activeLanguages.add(idxDict['language_no']);
    }

    function getLink(row) {
        if (activeLanguages.has(row.get('language_external')))
            return `<a class="table-link" href="../descriptions/${external2internal[row.get('language_external')]}.html">link</a>`;
        else
            return '';
    }

    // Prettify the df and subset columns
    let languageDfMin = languageDf
        .sortBy('language_external')
        .chain(
            row => row.set('transitivity ratio', row.get('transitivity ratio').toFixed(2)),
            row => row.set('intransitivity ratio', row.get('intransitivity ratio').toFixed(2)),
            row => row.set('entropy (nat)', row.get('entropy (nat)').toFixed(2)),
            row => row.set('normalised entropy', row.get('normalised entropy').toFixed(2)),
            row => row.set('entropy of intransitives (nat)', row.get('entropy of intransitives (nat)').toFixed(2)),
            row => row.set('maximum entropy for intransitives', row.get('maximum entropy for intransitives').toFixed(2)),
            row => row.set('entropy ratio', row.get('entropy ratio').toFixed(2)),
        )
        .select(...selectedColumns);

    // Add a link column
    selectedColumns.splice(1, 0, 'language_link')
    languageDfMin = languageDfMin.restructure(selectedColumns);
    languageDfMin = languageDfMin.map(row => row.set('language_link', getLink(row)))

    let columns = [],
        columnNamesDisplay = [];
    for (const colname of selectedColumns) {
        if (colname === 'language_external') {
            columnNamesDisplay.push('language');
            columns.push({renderer: 'text'});
        } else if (colname === 'language_link') {
            columnNamesDisplay.push(colname);
            columns.push({renderer: 'html'});
        } else {
            columnNamesDisplay.push(colname);
            columns.push({renderer: 'text'});
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        new Handsontable(byId('table'), {
            licenseKey: 'non-commercial-and-evaluation',
            data: languageDfMin.toArray(),
            colHeaders: columnNamesDisplay,
            editor: false,
            rowHeaders: false,
            filters: true,
            dropdownMenu: ['filter_by_condition', 'filter_by_value', 'filter_action_bar'],
            columns: columns,
            columnSorting: true
        });
    })
</script>